<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Ghostlet — Blooks</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://bjgxufxgpgojkwqbdyqp.supabase.co";
  const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJqZ3h1ZnhncGdvamt3cWJkeXFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTk1NjMsImV4cCI6MjA3ODk3NTU2M30.BRyjh8E2WK1KTquDhzfBtAmcBuxhZ4jRsZQgN_5s9rg";
  window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
</script>

<style>
  html,body{margin:0;padding:0;background:#050505;color:#fff;font-family:Segoe UI,Arial;overflow-x:hidden}
  .topbar{width:100%;background:#070707;padding:12px 20px;border-bottom:3px solid #00fef0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
  .topbar-left{color:#00fef0;font-weight:800;font-size:20px}
  .topbar-right{display:flex;gap:12px;flex-wrap:wrap}
  .topbar-right a{color:#fff;text-decoration:none;padding:8px 12px;border-radius:8px}
  .page-container{max-width:1100px;margin:24px auto;padding:20px;width:calc(100% - 40px)}
  .pack-group{background:#0e0e0e;padding:16px;border-radius:12px;margin-bottom:12px}
  .pack-title{color:#00fef0;font-weight:800}
  .blook-list{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
  .blook{background:#111;padding:8px;border-radius:10px;width:150px;text-align:center}
  .blook img{width:100%;height:96px;object-fit:contain;border-radius:8px}
  .empty{color:#aaa;padding:24px;text-align:center}
</style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-left">Ghostlet</div>
    <div class="topbar-right" id="navLinks"></div>
  </div>

  <div class="page-container">
    <h1 style="color:#00fef0">Your Blooks</h1>
    <div id="content"></div>
  </div>

<script>
  async function setup(){
    const nav = document.getElementById('navLinks');
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) { nav.innerHTML = `<a href="login.html">Login</a>`; return; }
    nav.innerHTML = `<a href="index.html">Home</a><a href="market.html">Market</a><a href="stats.html">Stats</a><a href="chat.html">Chat</a><a href="#" id="logout">Logout</a>`;
    document.getElementById('logout').onclick = async ()=>{ await supabase.auth.signOut(); location.href='login.html' };
    await loadBlooks(session.user.id);
  }

  async function loadBlooks(uid){
    // fetch user's blooks
    const { data, error } = await supabase.from('blooks').select('*').eq('user_id', uid).order('obtained_at', { ascending: true });
    const content = document.getElementById('content');
    content.innerHTML = '';
    if (!data || data.length === 0) { content.innerHTML = `<div class="empty">No blooks yet — open packs in Market.</div>`; return; }

    // Group by pack_id
    const groups = {};
    data.forEach(b => {
      const pack = b.pack_id || 'unknown';
      if (!groups[pack]) groups[pack] = [];
      groups[pack].push(b);
    });

    for (const packId of Object.keys(groups)) {
      const div = document.createElement('div'); div.className = 'pack-group';
      const title = document.createElement('div'); title.className = 'pack-title'; title.textContent = (packId === 'unknown' ? 'Unsorted' : packId.toUpperCase());
      div.appendChild(title);
      const list = document.createElement('div'); list.className = 'blook-list';
      for (const b of groups[packId]) {
        const card = document.createElement('div'); card.className = 'blook';
        card.innerHTML = `<img src="${b.image || 'https://i.ibb.co/0FQG7kF/friendly-ghost.png'}" alt="${b.name}"><div style="font-weight:700;margin-top:8px">${b.name}</div><div style="color:#ccc">${b.rarity}</div>`;
        list.appendChild(card);
      }
      div.appendChild(list);
      content.appendChild(div);
    }
  }

  setup();
</script>
</body>
</html>
